# 변경 감지와 병합(merge)

준영속 엔티티를 수정하는 방법



## 변경 감지

트랜잭션 안에서 엔티티를 다시 조회하고 값을 변경 

트랜잭션 커밋 시점에 변경 감지가 동작해서 데이터베이스에 update 쿼리가 실행된다.



## 병합

준영속 상태의 엔티티를 영속 상태로 만들어 준다.





## 두 방식의 차이점

변경 감지 기능은 원하는 속성만 선택해서 변경할 수 있지만, 병합은 모든 속성이 변경된다.

그래서 병합할 때 값이 없으면 null로 업데이트 될 위험이 있다.



- 실무에서는 가급적 merge보단 변경감지를 사용하는 게 더 좋다.

- setter보단 의미 있는 메소드를 사용하는 게 좋다. (추적하기도 쉬움)

- 컨트롤러에서 어설프게 엔티티를 생성하지 않는다.
- 트랜잭션이 있는 서비스 계층에 식별자와 변경할 데이터를 명확하게 전달한다.
- 트랜잭션 커밋 시점에 변경 감지가 실행된다.