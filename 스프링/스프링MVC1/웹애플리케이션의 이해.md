# 웹 서버(Web Server)와 웹 어플리케이션 서버(Web Application Server)



## 웹 서버

- http 기반으로 동작
- 정적 리소스 제공, 기타 부가기능
- 정적 html, css, js, 이미지, 영상



## 웹 애플리케이션 서버

- http 기반으로 동작
- 웹 서버 기능 포함 + (정적 리소스도 제공)
- 애플리케이션 로직을 수행
  - 동적 html, http api(json)
  - 서블릿, jsp,  스프링 mvc
- 예) 톰캣, Jetty, Undertow



## 웹 서버 VS 웹 애플리케이션 서버

차이점

- WS는 정적 리소스, WAS는 애플리케이션 로직
- WAS는 애플리케이션 코드를 실행하는 데 더 특화됨.



## 웹 시스템 구성

WAS도 정적 리소스를 처리할 수 있지만, WAS에 너무 많은 역할을 맡기게 되면 서버 과부하가 발생할 수 있다.

그렇기 때문에 정적 리소스는 웹 서버가 처리하고, 웹 서버는 동적인 처리에 대해서 WAS에 요청을 위임한다.

![image](https://user-images.githubusercontent.com/40904001/200794009-7b9ea1be-102c-40da-92ac-a5fd3b1a9d67.png)

이런 식으로 시스템을 구성하면 정적 리소스가 많으면 **WS**를 증설하고, 애플리케이션 리소스가 많아지면 **WAS**를 증설해 효율적으로 리소스를 관리할 수 있다.

그리고 이렇게 하면 WAS에 문제가 발생해도 정적 리소스만 제공하는 웹 서버는 잘 죽지 않기 때문에 오류화면을 제공할 수 있다.



# 서블릿(Servlet)

웹 애플리케이션 서버를 직접 구현하기 위해서 처리해야 하는 일이 굉장히 많고, 복잡하다.

이걸 개발자가 수작업으로 하기엔 무리가 있는 데, 비즈니스 로직을 제외한 모든 작업을 대신 처리해주는 기능이 바로 서블릿이다.

![image](https://user-images.githubusercontent.com/40904001/200798793-dd797d0b-a6c6-4c5c-8121-4f423536ccae.png)

- urlPatterns의 URL이 호출되면 서블릿 코드가 실행
- Http 요청 정보와 응답 정보를 편리하게 사용할 수 있는 HttpServletRequest, HttpServletResponse가 있다.



![image](https://user-images.githubusercontent.com/40904001/200799266-55e2e511-4d3d-4c77-9098-e8f45e578072.png)



## 서블릿 컨테이너

- 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 한다.
- 서블릿 객체를 생성, 초기화, 호출, 종료하는 생명주기 관리
- 서블릿 객체는 싱글톤으로 관리, 이 때 공유 변수 사용에 주의
- 동시 요청을 위한 멀티 쓰레드 지원



# 동시 요청 - 멀티 쓰레드

## 쓰레드

- 애플리케이션 코드를 하나하나 순차적으로 실행하는 것
- 쓰레드는 한번에 하나의 코드 라인만 수행
- 동시 처리를 하려면 쓰레드를 추가로 생성



## 다중 요청 - 단일 쓰레드

![image](https://user-images.githubusercontent.com/40904001/200814486-e675fded-4d85-4f49-aeb5-c3e6340eaedf.png)

동시에 2개 이상의 요청이 들어 왔을 때 한 개의 요청이 처리되는 동안에 다른 요청은 대기를 하게 된다.

이 때 처리되는 요청에서 지연이 발생하게 되어 타임아웃이 발생하면 다른 요청 역시 받아들이지 못하게 된다.



**이를 해결 하기 위해서**



## 요청마다 쓰레드 생성

![image](https://user-images.githubusercontent.com/40904001/200815814-4faf747a-727b-46d2-a40d-2ee15e852359.png)

이런 식으로 새로운 요청이 들어올 때마다 신규 쓰레드를 생성하면 위 문제를 해결할 수 있다.

하지만 이 방법에는 장단점이 존재한다.

### 장점

- 동시 요청을 처리할 수 있다.
- 하나의 쓰레드가 지연되어도, 나머지 쓰레드는 정상 동작

### 단점

- 쓰레드 생성 비용이 매우 비싸기 때문에 응답 속도가 늦어질 수 있다.
- 쓰레드는 전환할 때 컨텍스트 스위칭 비용이 발생한다.
- 쓰레드 생성에 제한이 없기 때문에 고객 요청이 동시에 너무 많이 오는 경우, 서버가 다운될 수 있다.



## 쓰레드 풀

요청마다 쓰레드 생성했을 때 단점을 보완하는 방법으로

쓰레드 풀에 생성 가능한 쓰레드의 최대치를 미리 만들어서 관리한다.

쓰레드가 필요할 때, 이미 생성되어 있는 쓰레드를 쓰레드 풀에서 꺼내서 사용한다.

사용을 종료하면 쓰레드 풀에 해당 쓰레드를 반납한다.

**최대 쓰레드가 모두 사용중이라면?**

- 이후 요청은 대기하거나 거절된다.

### 장점

- 쓰레드가 미리 생성되어 있기 때문에, 쓰레드 생성 비용이 절약되고, 응답 시간이 빠르다.
- 동시에 사용할 수 있는 쓰레드의 최대치를 정했기 때문에 많은 요청이 들어와도 안전하게 처리가 가능하다.



# HTML, HTTP API, CSR, SSR



## 정적 리소스

- 고정된 html 파일, css, js, img, 영상 등을 제공
- 주로 웹 브라우저



## html 페이지

- 동적으로 필요한 html 파일을 생성해서 전달
- 웹 브라우저 : html 해석



## HTTP API

- html이 아닌 데이터를 전달
- 주로 JSON 형태
- 다양한 시스템에서 호출
- 앱, 웹, Reac, Vue.js같은 웹 클라이언트
- 서버 to 서버



## 서버사이드 렌더링 (SSR)

- HTML 최종 결과를 서버에서 만들어서 브라우저에 전달

- 주로 정적인 화면에 사용

- 관련 기술 : JSP, thymeleaf



## 클라이언트 사이드 렌더링 (CSR)

- HTML 결과를 자바스크립트를 사용해 웹 브라우저에서 동적으로 생성
- 주로 동적인 화면에 사용
- 관련 기술: React, Vue.js

React, Vue처럼 CSR과 SSR을 동시에 지원하는 웹 프레임워크도 있다.

SSR로도 자바스크립트를 사용해서 화면을 동적으로 변경 가능







