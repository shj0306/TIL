# 로그인, 로그아웃, 회원가입 구현

실전 스프링 부트와 JPA 활용편에서 실습한 코드를 바탕으로 추가 혹은 수정하였습니다.

## 1. 메인 페이지 추가

로그인화면과 회원가입 화면으로 이동할 수 있도록 메인 페이지를 따로 추가하였습니다.

## 2. 회원 가입 정보 추가

- 아이디, 비밀번호, 이메일을 추가했고, 유효성 검사또한 추가했습니다.

### 2-1. 회원 가입 시 유효성 검사

- @Valid를 이용한 유효성 검사(@NotEmpty, @NotNull, @Email 등)

- 아이디 중복 검사 기능
  - 회원 가입 페이지에서 가입하고자 하는 아이디를 입력한다.
  - 해당 아이디가 이미 가입된 경우 아이디 입력란 안에 빨간색 경고 표시가, 가입된 아이디가 없다면 초록색 표시가 뜬다.
  
- 인증번호 이메일 전송

  - 이메일을 입력하고 인증 번호 전송 버튼을 클릭하면 밑에 입력란이 활성화되고 해당 인증번호를 입력해 일치할 경우 ''일치한다''는 메시지가 뜨고, 일치하지 않을 시 ''일치하지 않는다''라는 메시지를 띄운다.

  - 순서

  1. 이메일 전송 환경 세팅
  2. 인증번호 입력란 색상 변경 및 disabled 속성 추가
  3. 이메일 전송 메서드 추가
  4. controller 메서드 추가

- 주소록 API 연동

  - 순서
    1. 외부 스크립트 파일 연결 코드 추가
       - 다음 주소록 API 설명 홈페이지를 보면 통합 로딩방식/ 동적 로딩방식/ 정적 로딩방식이 있는데, 이 중에 **통합 로딩 방식**을 사용함.
    2. 주소 검색 기능 메서드 추가
    3. 다음 주소 팝업창 코드 추가
    4. 주소찾기 버튼과 메서드 연결
    5. 테스트

- 회원가입 유효성 검사

  - 아이디
  - 비밀번호
  - 이름
  - 이메일
  - 주소

  **Java의 Bean Validation**

  ![image](https://user-images.githubusercontent.com/40904001/194740909-1cceba03-d857-445f-954c-9ed58b909a4e.png)

  - 데이터 검증을 위한 로직을 도메인 모델 자체에 묶어서 표현하는 방법



## 로그인

1. 아이디, 비번 입력 후 서버 제출
2. DB 요청하여 아이디, 비번 일치 여부 확인
3. 일치시 메인페이지로 이동 
4. 불일치시 로그인 페이지 이동 (여기까지함)

### 로그인 버튼 작동 메서드

- JSP의 경우는 버튼 클릭시 메서드를 따로 구현해줘야 하는데 타임리프의 경우는 로그인 버튼을 클릭할 시 입력한 데이터가 loginForm 형태로 전달이 되기 때문에 구현해줄 필요가 없다.

### 로그인 처리 메서드

1. 세션을 사용하기 위해 session 변수를 선언하고 request.getSession으로 초기화한다.

2. 서버로부터 전달받은 account 정보로 memberService의 memberLogin을 사용해서 memberVO 객체를 초기화한다.

3. 이 때 memberVO 객체가 null이면 해당 계정이 존재하지 않는 것이기 때문에 로그인은 실패한다.

   3-1. 실패

   - 로그인 페이지로 리다이렉트
   - redirectAttributes에 0값을 담아준다.

   3-2. 성공

   - 메인페이지로 이동
   - session에 memberVO객체를 담아준다.



### 비밀번호 인코딩(BCryptPasswordEncoder 적용)

1. 회원가입 메서드에 인코딩을 적용해서 인코딩된 비밀번호가 데이터베이스에 저장되게 한다.
2. 로그인 메서드에서 사용자가 제출한 비밀번호와 데이터베이스에 저장된 인코딩된 비밀번호가 일치하는 지를 확인한다.

- 회원가입 메서드 처리과정
  1. 회원정보가 담긴 member에 저장된 비밀번호를 꺼낸다.
  2. 비밀번호를 encoding
  3. encoding된 비밀번호를 다시 객체에 저장
  4. memberJoin()을 통해서 회원가입 실행
- 로그인 메서드 처리과정
  - 기존에는 아이디와 비밀번호를 토대로 계정의 유무를 파악했지만 비밀번호가 인코딩 되어있기 때문에 올바른 비밀번호를 입력해도 제대로된 결과가 나오지 않게 된다.
  - 그렇기 때문에 아이디로 조회를 해서 없다면 실패고, 있는 경우에는 matches함수를 통해 인코딩된 비밀번호와 사용자가 입력한 비밀번호가 일치한지를 파악하고 일치한다면 로그인 성공



### 로그아웃 기능 구현

- 로그아웃 버튼 작성
- 로그아웃 메서드 작성
- 테스트

#### 로그아웃 메서드 작성

- GET 방식
- session에 대한 작업을 해야하기 때문에 httpservletRequest 타입의 매개변수를 넣음.

로그인할 때 세션에 저장했던 "member"라는 정보를 제거할 수 있는 메서드가 removeAttribute와 invalidate가 있다.

invalidate의 경우 전체 세션 정보를 초기화하는 메서드고, removeAttribute는 특정 session 객체를 제거하는 메서드입니다.

로그아웃을 하면 사용할 세션이 없기 때문에 invalidate()을 사용했다.































## 참고

[실전 스프링 부트와 JPA활용1](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-%ED%99%9C%EC%9A%A9-1/dashboard)

[실전 스프링 부트와 JPA활용2](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81%EB%B6%80%ED%8A%B8-JPA-API%EA%B0%9C%EB%B0%9C-%EC%84%B1%EB%8A%A5%EC%B5%9C%EC%A0%81%ED%99%94/dashboard)

[참고 블로그](https://kimvampa.tistory.com/70?category=771727)